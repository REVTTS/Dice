{"version":3,"file":"Dice.umd.js","sources":["../src/tokens/brackets.js","../src/tokens/operators.js","../src/tokens/string.js","../src/tokens/numbers.js","../src/tokens/whitespace.js","../src/lexer.js","../src/parser.js","../src/interpreter.js","../src/Formatter.js","../src/Dice.js"],"sourcesContent":["/*\n  Copyright (C) 2022 REVTTS, Ronald M Zielaznicki\n\n  This file is part of REVTTS Dice.\n\n  REVTTS Dice is free software: you can redistribute it and/or modify it under the terms of\n  the GNU General Public License as published by the Free Software Foundation, either\n  version 3 of the License, or any later version.\n\n  REVTTS Dice is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n  without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR\n  PURPOSE. See the GNU General Public License for more details.\n\n  You should have received a copy of the GNU General Public License along with REVTTS Dice.\n  If not, see <https://www.gnu.org/licenses/>. \n*/\n\nimport { createToken } from 'chevrotain';\n\n// Angle Brackets\nexport const token_bracket_angle_close = createToken({\n  name: 'bracket_angle_close',\n  pattern: />/,\n});\n\nexport const token_bracket_angle_open = createToken({\n  name: 'bracket_angle_open',\n  pattern: /</,\n});\n\n\n// Curley Brackets\nexport const token_bracket_curley_close = createToken({\n  name: 'bracket_curley_close',\n  pattern: /\\}/,\n});\n\nexport const token_bracket_curley_open = createToken({\n  name: 'bracket_curley_open',\n  pattern: /\\{/,\n});\n\n\n// Round Brackets, aka parenthesis\nexport const token_bracket_round_close = createToken({\n  name: 'bracket_round_close',\n  pattern: /\\)/,\n});\n\nexport const token_bracket_round_open = createToken({\n  name: 'bracket_round_open',\n  pattern: /\\(/,\n});\n\n\n// Square Brackets\nexport const token_bracket_square_close = createToken({\n  name: 'bracket_square_close',\n  pattern: /\\]/,\n});\n\nexport const token_bracket_square_open = createToken({\n  name: 'bracket_square_open',\n  pattern: /\\[/,\n});\n","/*\n  Copyright (C) 2022 REVTTS, Ronald M Zielaznicki\n\n  This file is part of REVTTS Dice.\n\n  REVTTS Dice is free software: you can redistribute it and/or modify it under the terms of\n  the GNU General Public License as published by the Free Software Foundation, either\n  version 3 of the License, or any later version.\n\n  REVTTS Dice is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n  without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR\n  PURPOSE. See the GNU General Public License for more details.\n\n  You should have received a copy of the GNU General Public License along with REVTTS Dice.\n  If not, see <https://www.gnu.org/licenses/>. \n*/\n\nimport { createToken } from 'chevrotain';\n\nexport const token_operator_absolute = createToken({\n  name: 'abs',\n  pattern: /abs/,\n});\n\nexport const token_operator_ceil = createToken({\n  name: 'ceil',\n  pattern: /ceil/,\n});\n\nexport const token_operator_die = createToken({\n  name: 'd',\n  pattern: /[dD]/,\n});\n\nexport const token_operator_alt_die = createToken({\n  name: 'alt_die',\n  pattern: /.die/,\n});\n\nexport const token_operator_divide = createToken({\n  name: 'divide',\n  pattern: /\\//,\n});\n\nexport const token_operator_dot = createToken({\n  name: 'dot',\n  pattern: /\\./,\n});\n\nexport const token_operator_exponent = createToken({\n  name: 'exponent',\n  pattern: /\\*\\*/,\n});\n\nexport const token_operator_floor = createToken({\n  name: 'floor',\n  pattern: /floor/,\n});\n\nexport const token_operator_modulus = createToken({\n  name: 'modulus',\n  pattern: /%/,\n});\n\nexport const token_operator_minus = createToken({\n  name: 'minus',\n  pattern: /-/,\n});\n\nexport const token_operator_multiply = createToken({\n  name: 'multiply',\n  pattern: /\\*/,\n});\n\nexport const token_operator_plus = createToken({\n  name: 'plus',\n  pattern: /\\+/,\n});\n\nexport const token_operator_round = createToken({\n  name: 'round',\n  pattern: /round/,\n});\n","/*\n  Copyright (C) 2022 REVTTS, Ronald M Zielaznicki\n\n  This file is part of REVTTS Dice.\n\n  REVTTS Dice is free software: you can redistribute it and/or modify it under the terms of\n  the GNU General Public License as published by the Free Software Foundation, either\n  version 3 of the License, or any later version.\n\n  REVTTS Dice is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n  without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR\n  PURPOSE. See the GNU General Public License for more details.\n\n  You should have received a copy of the GNU General Public License along with REVTTS Dice.\n  If not, see <https://www.gnu.org/licenses/>. \n*/\n\nimport { createToken } from 'chevrotain';\n\nexport const token_string = createToken({\n  name: 'string',\n  pattern: /[a-zA-Z]+/,\n});","/*\n  Copyright (C) 2022 REVTTS, Ronald M Zielaznicki\n\n  This file is part of REVTTS Dice.\n\n  REVTTS Dice is free software: you can redistribute it and/or modify it under the terms of\n  the GNU General Public License as published by the Free Software Foundation, either\n  version 3 of the License, or any later version.\n\n  REVTTS Dice is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n  without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR\n  PURPOSE. See the GNU General Public License for more details.\n\n  You should have received a copy of the GNU General Public License along with REVTTS Dice.\n  If not, see <https://www.gnu.org/licenses/>. \n*/\n\nimport { createToken } from 'chevrotain';\n\nexport const token_number_zero = createToken({\n  name: 'number_zero',\n  pattern: /0/,\n});\n\nexport const token_number_one = createToken({\n  name: 'number_one',\n  pattern: /1/,\n});\n\nexport const token_number_two = createToken({\n  name: 'number_two',\n  pattern: /2/,\n});\n\nexport const token_number_three = createToken({\n  name: 'number_three',\n  pattern: /3/,\n});\n\nexport const token_number_four = createToken({\n  name: 'number_four',\n  pattern: /4/,\n});\n\nexport const token_number_five = createToken({\n  name: 'number_five',\n  pattern: /5/,\n});\n\nexport const token_number_six = createToken({\n  name: 'number_six',\n  pattern: /6/,\n});\n\nexport const token_number_seven = createToken({\n  name: 'number_seven',\n  pattern: /7/,\n});\n\nexport const token_number_eight = createToken({\n  name: 'number_eight',\n  pattern: /8/,\n});\n\nexport const token_number_nine = createToken({\n  name: 'number_nine',\n  pattern: /9/,\n});","/*\n  Copyright (C) 2022 REVTTS, Ronald M Zielaznicki\n\n  This file is part of REVTTS Dice.\n\n  REVTTS Dice is free software: you can redistribute it and/or modify it under the terms of\n  the GNU General Public License as published by the Free Software Foundation, either\n  version 3 of the License, or any later version.\n\n  REVTTS Dice is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n  without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR\n  PURPOSE. See the GNU General Public License for more details.\n\n  You should have received a copy of the GNU General Public License along with REVTTS Dice.\n  If not, see <https://www.gnu.org/licenses/>. \n*/\n\nimport { createToken, Lexer } from 'chevrotain';\n\nexport const token_whitespace = createToken({\n  name: 'whitespace',\n  pattern: /\\s/,\n});\n\nexport const token_whitespace_skip = createToken({\n  group: Lexer.SKIPPED,\n  name: 'whitespace',\n  pattern: /\\s/\n});\n","/*\n  Copyright (C) 2022 REVTTS, Ronald M Zielaznicki\n\n  This file is part of REVTTS Dice.\n\n  REVTTS Dice is free software: you can redistribute it and/or modify it under the terms of\n  the GNU General Public License as published by the Free Software Foundation, either\n  version 3 of the License, or any later version.\n\n  REVTTS Dice is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n  without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR\n  PURPOSE. See the GNU General Public License for more details.\n\n  You should have received a copy of the GNU General Public License along with REVTTS Dice.\n  If not, see <https://www.gnu.org/licenses/>. \n*/\n\nimport { Lexer } from 'chevrotain';\n\nimport {\n  token_bracket_curley_open,\n  token_bracket_curley_close,\n  token_bracket_round_close,\n  token_bracket_round_open,\n} from './tokens/brackets.js';\nimport * as operator_tokens from './tokens/operators.js';\nimport { token_string } from './tokens/string.js';\nimport * as number_tokens from './tokens/numbers.js';\n\n\nimport { token_whitespace_skip } from './tokens/whitespace.js';\n\nconst tokens = [\n  token_bracket_curley_open,\n  token_bracket_curley_close,\n  token_bracket_round_close,\n  token_bracket_round_open,\n  ...Object.values(operator_tokens),\n  ...Object.values(number_tokens),\n  token_whitespace_skip,\n  token_string,\n];\n\nexport default new Lexer(tokens);","/*\n  Copyright (C) 2022 REVTTS, Ronald M Zielaznicki\n\n  This file is part of REVTTS Dice.\n\n  REVTTS Dice is free software: you can redistribute it and/or modify it under the terms of\n  the GNU General Public License as published by the Free Software Foundation, either\n  version 3 of the License, or any later version.\n\n  REVTTS Dice is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n  without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR\n  PURPOSE. See the GNU General Public License for more details.\n\n  You should have received a copy of the GNU General Public License along with REVTTS Dice.\n  If not, see <https://www.gnu.org/licenses/>. \n*/\n\nimport { CstParser } from 'chevrotain';\n\nimport {\n  token_bracket_curley_open,\n  token_bracket_curley_close,\n  token_bracket_round_close,\n  token_bracket_round_open\n} from './tokens/brackets.js';\nimport * as operator_tokens from './tokens/operators.js';\nimport { token_string } from './tokens/string.js';\nimport * as number_tokens from './tokens/numbers.js';\n\nexport class Parser extends CstParser {\n  constructor(tokens) {\n    super(tokens);\n\n    // Ordered by operation. The higher it is, the more precedence.\n    this.RULE('expression', () => {\n      this.SUBRULE(this.minus_expression, { LABEL: 'expression'});\n    });\n\n    // While the above is ordered by order of operations, the below is\n    // ordered alphabetically.\n    this.RULE('absolute_expression', () => {\n      this.CONSUME(operator_tokens.token_operator_absolute, { LABEL: 'operator' });\n      this.SUBRULE(this.parenthesis_expression, { LABEL: 'expression' });\n    });\n\n    this.RULE('addition_expression', () => {\n      this.SUBRULE(this.modulus_expression, { LABEL: 'left_hand' });\n      this.MANY(() => {\n        this.CONSUME(operator_tokens.token_operator_plus, { LABEL: 'operator' });\n        this.SUBRULE2(this.modulus_expression, { LABEL: 'right_hand' });\n      });\n    });\n\n    // Atomic might not be the right name here.\n    // Need to do some reading\n    this.RULE('atomic_expression', () => {\n      this.OR([\n        { ALT: () => this.SUBRULE(this.absolute_expression, { LABEL: 'expression' }) },\n        { ALT: () => this.SUBRULE(this.ceil_expression, { LABEL: 'expression' }) },\n        { ALT: () => this.SUBRULE(this.floor_expression, { LABEL: 'expression' }) },\n        { ALT: () => this.SUBRULE(this.negative_number_expression, { LABEL: 'expression' }) },\n        { ALT: () => this.SUBRULE(this.parenthesis_expression, { LABEL: 'expression' }) },\n        { ALT: () => this.SUBRULE(this.round_expression, { LABEL: 'expression' }) },\n        { ALT: () => this.SUBRULE(this.variable_expression, { LABEL: 'expression' }) },\n        { ALT: () => this.SUBRULE(this.whole_number_expression, { LABEL: 'expression' }) },\n      ]);\n    });\n\n    this.RULE('ceil_expression', () => {\n      this.CONSUME(operator_tokens.token_operator_ceil, { LABEL: 'operator' });\n      this.SUBRULE(this.parenthesis_expression, { LABEL: 'expression' });\n    });\n\n    this.RULE('die_expression', () => {\n      this.SUBRULE(this.real_number_expression, { LABEL: 'left_hand' });\n      this.MANY(() => {\n        this.OR([\n          {\n            ALT: () => {\n              this.CONSUME(operator_tokens.token_operator_die, { LABEL: 'operator' });\n              this.SUBRULE2(this.real_number_expression, { LABEL: 'right_hand' });\n            }\n          },\n          {\n            ALT: () => {\n              this.CONSUME(operator_tokens.token_operator_alt_die, { LABEL: 'operator' });\n              this.SUBRULE(this.parenthesis_expression, { LABEL: 'right_hand' });\n            }\n          },\n        ]);\n      });\n    });\n\n    this.RULE('divide_expression', () => {\n      this.SUBRULE(this.multiply_expression, { LABEL: 'left_hand' });\n      this.MANY(() => {\n        this.CONSUME(operator_tokens.token_operator_divide, { LABEL: 'operator' });\n        this.SUBRULE2(this.multiply_expression, { LABEL: 'right_hand' });\n      });\n    });\n\n    this.RULE('exponential_expression', () => {\n      this.SUBRULE(this.die_expression, { LABEL: 'left_hand' });\n      this.MANY(() => {\n        this.CONSUME(operator_tokens.token_operator_exponent, { LABEL: 'operator' });\n        this.SUBRULE2(this.die_expression, { LABEL: 'right_hand' });\n      });\n    });\n\n    this.RULE('floor_expression', () => {\n      this.CONSUME(operator_tokens.token_operator_floor, { LABEL: 'operator' });\n      this.SUBRULE2(this.parenthesis_expression, { LABEL: 'expression' });\n    });\n\n    this.RULE('minus_expression', () => {\n      this.SUBRULE(this.addition_expression, { LABEL: 'left_hand'});\n      this.MANY(() => {\n        this.CONSUME(operator_tokens.token_operator_minus, { LABEL: 'operator' });\n        this.SUBRULE2(this.addition_expression, { LABEL: 'right_hand' });\n      });\n    });\n\n    this.RULE('modulus_expression', () => {\n      this.SUBRULE(this.divide_expression, { LABEL: 'left_hand'});\n      this.MANY(() => {\n        this.CONSUME(operator_tokens.token_operator_modulus, { LABEL: 'operator' });\n        this.SUBRULE2(this.divide_expression, { LABEL: 'right_hand' });\n      });\n    });\n\n    this.RULE('multiply_expression', () => {\n      this.SUBRULE(this.exponential_expression, { LABEL: 'left_hand' });\n      this.MANY(() => {\n        this.CONSUME(operator_tokens.token_operator_multiply, { LABEL: 'operator' });\n        this.SUBRULE2(this.exponential_expression, { LABEL: 'right_hand' });\n      });\n    });\n\n    this.RULE('negative_number_expression', () => {\n      this.CONSUME(operator_tokens.token_operator_minus);\n      this.SUBRULE(this.expression);\n    });\n\n    this.RULE('parenthesis_expression', () => {\n      this.CONSUME(token_bracket_round_open);\n      this.SUBRULE(this.expression, { LABEL: 'expression' });\n      this.CONSUME(token_bracket_round_close);\n    });\n\n    this.RULE('real_number_expression', () => {\n      this.OR([\n        {\n          ALT: () => {\n            this.SUBRULE(this.atomic_expression, { LABEL: 'left_hand'});\n            // Real number with a leading expression.\n            // ie. \"1.05\"\n            // Unlike most other expressions, this is not a MANY.\n            // 1.05.05 doesn't make sense afaik.\n            this.OPTION(() => {\n              this.CONSUME(operator_tokens.token_operator_dot, { LABEL: 'operator' });\n              this.SUBRULE2(this.atomic_expression, { LABEL: 'right_hand'});\n            });\n          }\n        },\n        // Real number without a leading expression.\n        // ie. \".05\"\n        {\n          ALT: () => {\n            this.CONSUME2(operator_tokens.token_operator_dot, { LABEL: 'operator' });\n            this.SUBRULE3(this.atomic_expression, { LABEL: 'right_hand'});\n          }\n        },\n      ]);\n    });\n\n    this.RULE('round_expression', () => {\n      this.CONSUME(operator_tokens.token_operator_round, { LABEL: 'operator' });\n      this.SUBRULE(this.parenthesis_expression, { LABEL: 'expression' });\n    });\n\n    this.RULE('whole_number_expression', () => {\n      this.AT_LEAST_ONE(() => { this.SUBRULE(this.whole_number); });\n    });\n\n    this.RULE('whole_number', () => {\n      this.OR([\n        { ALT: () => this.SUBRULE(this.whole_number_zero) },\n        { ALT: () => this.SUBRULE(this.whole_number_one) },\n        { ALT: () => this.SUBRULE(this.whole_number_two) },\n        { ALT: () => this.SUBRULE(this.whole_number_three) },\n        { ALT: () => this.SUBRULE(this.whole_number_four) },\n        { ALT: () => this.SUBRULE(this.whole_number_five) },\n        { ALT: () => this.SUBRULE(this.whole_number_six) },\n        { ALT: () => this.SUBRULE(this.whole_number_seven) },\n        { ALT: () => this.SUBRULE(this.whole_number_eight) },\n        { ALT: () => this.SUBRULE(this.whole_number_nine) },\n      ]);\n    });\n\n    this.RULE('whole_number_zero', () => {\n      this.CONSUME(number_tokens.token_number_zero);\n    });\n\n    this.RULE('whole_number_one', () => {\n      this.CONSUME(number_tokens.token_number_one);\n    });\n\n    this.RULE('whole_number_two', () => {\n      this.CONSUME(number_tokens.token_number_two);\n    });\n\n    this.RULE('whole_number_three', () => {\n      this.CONSUME(number_tokens.token_number_three);\n    });\n\n    this.RULE('whole_number_four', () => {\n      this.CONSUME(number_tokens.token_number_four);\n    });\n\n    this.RULE('whole_number_five', () => {\n      this.CONSUME(number_tokens.token_number_five);\n    });\n\n    this.RULE('whole_number_six', () => {\n      this.CONSUME(number_tokens.token_number_six);\n    });\n\n    this.RULE('whole_number_seven', () => {\n      this.CONSUME(number_tokens.token_number_seven);\n    });\n\n    this.RULE('whole_number_eight', () => {\n      this.CONSUME(number_tokens.token_number_eight);\n    });\n\n    this.RULE('whole_number_nine', () => {\n      this.CONSUME(number_tokens.token_number_nine);\n    });\n\n    this.RULE('variable_expression', () => {\n      this.CONSUME(token_bracket_curley_open);\n      this.CONSUME(token_string);\n      this.CONSUME(token_bracket_curley_close);\n    });\n\n    this.performSelfAnalysis();\n  }\n}\n\nexport const getParser = () => new Parser([\n  token_bracket_curley_open,\n  token_bracket_curley_close,\n  token_bracket_round_close,\n  token_bracket_round_open,\n  ...Object.values(operator_tokens),\n  ...Object.values(number_tokens),\n  token_string,\n]);\n\nexport default getParser();","/*\n  Copyright (C) 2022 REVTTS, Ronald M Zielaznicki\n\n  This file is part of REVTTS Dice.\n\n  REVTTS Dice is free software: you can redistribute it and/or modify it under the terms of\n  the GNU General Public License as published by the Free Software Foundation, either\n  version 3 of the License, or any later version.\n\n  REVTTS Dice is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n  without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR\n  PURPOSE. See the GNU General Public License for more details.\n\n  You should have received a copy of the GNU General Public License along with REVTTS Dice.\n  If not, see <https://www.gnu.org/licenses/>. \n*/\n\nimport parser from './parser.js';\n\nconst BaseSQLVisitor = parser.getBaseCstVisitorConstructorWithDefaults();\n\nconst zip_outputs = (arrays, operator) => {\n  const array_one = arrays.shift();\n  const array_two = arrays.shift();\n\n  const zipped_output = Array.from(\n    Array(\n      Math.max(array_one.length, array_two.length)\n    ),\n    (_, i) => {\n      const array_one_value = array_one[i] || array_one[array_one.length-1];\n      const array_two_value = array_two[i] || array_two[array_two.length-1];\n\n      return `${array_one_value}${operator}${array_two_value}`;\n    }\n  );\n\n  if (arrays.length > 0) {\n    return zip_outputs([zipped_output, ...arrays], operator);\n  }\n\n  return zipped_output;\n};\n\nfunction unary_expression(ctx, operator_wrap_fn, operator_function, visit_function, options) {\n  const visit = visit_function(ctx.expression, options);\n  const visit_value = do_add_values(visit.values);\n  const value = operator_function(visit_value);\n\n  const new_outputs = visit.outputs.map((output) => operator_wrap_fn(output));\n\n  return {\n    outputs: [...new_outputs, options.formatter.format_result(`${value}`)],\n    values: [value],\n  };\n}\n\nconst do_add_values = values => values.reduce((accumulator, value) => (accumulator + value));\nconst do_divide_values = values => values.reduce((accumulator, value) => (accumulator / value));\nconst do_exponential_values = values => values.reduce((accumulator, value) => (accumulator ** value));\nconst do_minus_values = values => values.reduce((accumulator, value) => (accumulator - value));\nconst do_modulus_values = values => values.reduce((accumulator, value) => (accumulator % value));\nconst do_multiply_values = values => values.reduce((accumulator, value) => (accumulator * value));\n\nfunction binary_expression(ctx, operator, operator_function, visit_function, options) {\n  let left_hand_visit = visit_function(ctx.left_hand, options);\n\n  if (ctx.right_hand) {\n    // Visit each item in the right hand array.\n    const right_hand_visits = ctx.right_hand.map(right_hand => visit_function(right_hand, options));\n    const right_hand_outputs = right_hand_visits.map(right_hand_visit => right_hand_visit.outputs);\n\n    // We've got an array of an array of values.\n    // So we condense it down to an array of values.\n    const right_hand_values = right_hand_visits.map(visit => do_add_values(visit.values));\n\n    const value = operator_function([\n      do_add_values(left_hand_visit.values),\n      ...right_hand_values\n    ]);\n\n    // return our total values together in our own array of values.\n    return {\n      outputs: [...zip_outputs([left_hand_visit.outputs, ...right_hand_outputs], operator), options.formatter.format_result(`${value}`)],\n      values: [value],\n    };\n  }\n\n  return left_hand_visit;\n}\n\nexport class Interpreter extends BaseSQLVisitor {\n  constructor() {\n    super();\n\n    this.validateVisitor();\n  }\n\n  expression(ctx, options) {\n    return this.visit(ctx.expression, options);\n  }\n\n  // Interpreter methods are ordered alphabetically.\n\n  absolute_expression(ctx, options) {\n    return unary_expression(ctx, (output) => `abs(${output})`, Math.abs, this.visit.bind(this), options);\n  }\n\n  addition_expression(ctx, options) {\n    return binary_expression(ctx, '+', do_add_values, this.visit.bind(this), options);\n  }\n\n  atomic_expression(ctx, options) {\n    return this.visit(ctx.expression, options);\n  }\n\n  ceil_expression(ctx, options) {\n    return unary_expression(ctx, (output) => `ceil(${output})`, Math.ceil, this.visit.bind(this), options);\n  }\n\n  die_expression(ctx, options) {\n    const left_hand_visit = this.visit(ctx.left_hand, options);\n  \n    if (ctx.right_hand) {\n      // Visit each item in the right hand array.\n      const right_hand_visits = ctx.right_hand.map(right_hand => this.visit(right_hand, options));\n      const right_hand_outputs = right_hand_visits.map(right_hand_visit => right_hand_visit.outputs);\n  \n      // We've got an array of an array of values.\n      // So we condense it down to an array of values.\n      const right_hand_values = right_hand_visits.map(visit => do_add_values(visit.values));\n\n      const values = right_hand_values.reduce((previous_values, die_size) => {\n        let num_dice = do_add_values(previous_values);\n        const sign = Math.sign(num_dice) * Math.sign(die_size);\n\n        if (sign === 0)\n          return [0];\n  \n        const next_values = [];\n        num_dice = Math.abs(num_dice);\n        for (let i = 0; i < num_dice; i++)\n          next_values.push(sign * Math.floor(options.prng() * Math.abs(die_size) + .9999));\n\n        return next_values;\n      }, left_hand_visit.values);\n\n      if (values.length === 0)\n        values.push(0);\n  \n      // return our total values together in our own array of values.\n      return {\n        outputs: [...zip_outputs([left_hand_visit.outputs, ...right_hand_outputs], 'd'), values.map(value => options.formatter.format_dice_result(value)).join(', ')],\n        values,\n      };\n    }\n  \n    return left_hand_visit;\n  }\n\n  divide_expression(ctx, options) {\n    return binary_expression(ctx, '/', do_divide_values, this.visit.bind(this), options);\n  }\n\n  exponential_expression(ctx, options) {\n    return binary_expression(ctx, '**', do_exponential_values, this.visit.bind(this), options);\n  }\n\n  floor_expression(ctx, options) {\n    return unary_expression(ctx, (output) => `floor(${output})`, Math.floor, this.visit.bind(this), options);\n  }\n\n  minus_expression(ctx, options) {\n    return binary_expression(ctx, '-',  do_minus_values, this.visit.bind(this), options);\n  }\n\n  modulus_expression(ctx, options) {\n    return binary_expression(ctx, '%', do_modulus_values, this.visit.bind(this), options);\n  }\n\n  multiply_expression(ctx, options) {\n    return binary_expression(ctx, '*', do_multiply_values, this.visit.bind(this), options);\n  }\n\n  negative_number_expression(ctx, options) {\n    return unary_expression(ctx, (output) => `-${output}`, (input) => -input, this.visit.bind(this), options);\n  }\n\n  parenthesis_expression(ctx, options) {\n    return this.visit(ctx.expression, options);\n  }\n\n  real_number_expression(ctx, options) {\n    if (ctx.right_hand) {\n      const right_hand_visit = this.visit(ctx.right_hand, options);\n      const num_digits = right_hand_visit.values.length;\n      const decimal_value = do_add_values(right_hand_visit.values) / (10 ** num_digits);\n\n      if (ctx.left_hand) {\n        const left_hand_visit = this.visit(ctx.left_hand, options);\n        const value = do_add_values(left_hand_visit.values) + decimal_value;\n\n        return {\n          outputs: [...zip_outputs([left_hand_visit.outputs, right_hand_visit.outputs], '.'), options.formatter.format_result(`${value}`)],\n          values: [value],\n        };\n      }\n\n      const new_outputs = right_hand_visit.outputs.map((output) => `.${output}`);\n\n      return {\n        outputs: [...new_outputs, options.formatter.format_result(`${decimal_value}`)],\n        values: [decimal_value],\n      };\n    }\n\n    return this.visit(ctx.left_hand, options);\n  }\n\n  round_expression(ctx, options) {\n    return unary_expression(ctx, (output) => `round(${output})`, Math.round, this.visit.bind(this), options);\n  }\n\n  whole_number_expression(ctx) {\n    let values = [];\n\n    const length = ctx.whole_number.length;\n\n    for (let i in ctx.whole_number) {\n      values.push(this.visit(ctx.whole_number[i]) * (10 ** (length - 1 - i)));\n    }\n\n    return {\n      outputs: [`${do_add_values(values)}`],\n      values,\n    };\n  }\n\n  whole_number(ctx) {\n    const key = Object.keys(ctx)[0];\n    return this.visit(ctx[key]);\n  }\n\n  whole_number_zero()  { return 0; }\n  whole_number_one()   { return 1; }\n  whole_number_two()   { return 2; }\n  whole_number_three() { return 3; }\n  whole_number_four()  { return 4; }\n  whole_number_five()  { return 5; }\n  whole_number_six()   { return 6; }\n  whole_number_seven() { return 7; }\n  whole_number_eight() { return 8; }\n  whole_number_nine()  { return 9; }\n\n  variable_expression(ctx, options) {\n    const value = options.variables.get(ctx.string[0].image) || 0;\n    return {\n      outputs: [`${value}`],\n      values: [value],\n    };\n  }\n\n}\n\nconst interpreter = new Interpreter(Math.random);\n\nexport default interpreter;","export class Formatter {\n  constructor() {}\n\n  /**\n   * Formats an individual result from rolled dice.\n   * \n   * @param {String} input \n   * @returns String\n   */\n  format_dice_result(input) {\n    return this.format_result(input);\n  }\n\n  /**\n   * The default format for any result.\n   * \n   * @param {String} input \n   * @returns String\n   */\n  format_result(input) {\n    return input;\n  }\n}","/*\n  Copyright (C) 2022 REVTTS, Ronald M Zielaznicki\n\n  This file is part of REVTTS Dice.\n\n  REVTTS Dice is free software: you can redistribute it and/or modify it under the terms of\n  the GNU General Public License as published by the Free Software Foundation, either\n  version 3 of the License, or any later version.\n\n  REVTTS Dice is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n  without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR\n  PURPOSE. See the GNU General Public License for more details.\n\n  You should have received a copy of the GNU General Public License along with REVTTS Dice.\n  If not, see <https://www.gnu.org/licenses/>. \n*/\n\nimport lexer from './lexer.js';\nimport { Interpreter } from './interpreter.js';\nimport { getParser } from './parser.js';\nimport { Formatter } from './Formatter.js';\n\n/**\n * @typedef {Object} RollOutput The output from a roll\n * @property {str|any} image A string if undefined, but defined by the formatter\n *  if provided. Unused at this time.\n * @property {Number} value The result of a roll of of the die\n */\n\n/**\n * @typedef {Object} Formatter The object that determines the image of the roll.\n *  This is unused right now, it's a placeholder for future improvements.\n */\n\n/**\n * @typedef {Object} RollOptions\n * @property {Formatter?} formatter The object that determines the image of the roll.\n *  This is unused right now, it's a placeholder for future improvements.\n * @property {Function?} prng A function that returns a number between 0 and 1\n *  non-inclusive. Default is Math.random.\n * @property {Iterable<Iterable>?} variables Values utilized to translate die variable references\n *  into their appropriate values. ex. [ ['strength', 10], ['dexterity', 12] ]\n */\n\nexport class Dice {\n  constructor() {\n    this.interpreter = new Interpreter();\n    this.parser = getParser();\n  }\n  \n  /**\n   * @function roll\n   * @param {string} input A string representation of a die.\n   * @param {RollOptions} options How to format the image of the RollOutput.\n   * @returns {RollOutput} The result of the die being rolled.\n   * */\n  roll(input, { formatter, prng, variables } = {}) {\n    // Tokenize the input with our lexer.\n    const lex_result = lexer.tokenize(input);\n\n    if (lex_result.errors.length > 0) {\n      const offset = lex_result.errors[0].offset;\n      throw new Error(`Unexpected character \"${input.charAt(offset)}\" at position: ${offset}`);\n    }\n\n    if (!formatter)\n      formatter = new Formatter();\n\n    // Do we have a prng? If not, set it to Math.random\n    if (!prng)\n      prng = Math.random;\n\n    // If we don't have variables, start with an empty array\n    if (!variables)\n      variables = [];\n\n    const variable_map = new Map();\n    variables.forEach((key_value) => {\n      // TODO: Assert key is a string.\n      // TODO: Assert key follows the correct format.\n      variable_map.set(key_value[0].toLowerCase(), key_value[1]);\n    });\n\n    // Pass our tokens into our parser\n    this.parser.input = lex_result.tokens;\n    const cst = this.parser.expression();\n\n    if (this.parser.errors.length > 0) {\n      throw new Error(this.parser.errors[0]);\n    }\n\n    // Interpret the parsed tokens and return the result.\n    return this.interpreter.visit(cst, {\n      formatter,\n      prng,\n      variables: variable_map\n    });\n  }\n}\n"],"names":["createToken","name","pattern","token_bracket_curley_close","token_bracket_curley_open","token_bracket_round_close","token_bracket_round_open","token_operator_absolute","token_operator_ceil","token_operator_die","token_operator_alt_die","token_operator_divide","token_operator_dot","token_operator_exponent","token_operator_floor","token_operator_modulus","token_operator_minus","token_operator_multiply","token_operator_plus","token_operator_round","token_string","token_number_zero","token_number_one","token_number_two","token_number_three","token_number_four","token_number_five","token_number_six","token_number_seven","token_number_eight","token_number_nine","token_whitespace_skip","group","Lexer","SKIPPED","tokens","Object","values","operator_tokens","number_tokens","lexer","Parser","CstParser","constructor","super","this","RULE","SUBRULE","minus_expression","LABEL","CONSUME","operator_tokens.token_operator_absolute","parenthesis_expression","modulus_expression","MANY","operator_tokens.token_operator_plus","SUBRULE2","OR","ALT","absolute_expression","ceil_expression","floor_expression","negative_number_expression","round_expression","variable_expression","whole_number_expression","operator_tokens.token_operator_ceil","real_number_expression","operator_tokens.token_operator_die","operator_tokens.token_operator_alt_die","multiply_expression","operator_tokens.token_operator_divide","die_expression","operator_tokens.token_operator_exponent","operator_tokens.token_operator_floor","addition_expression","operator_tokens.token_operator_minus","divide_expression","operator_tokens.token_operator_modulus","exponential_expression","operator_tokens.token_operator_multiply","expression","atomic_expression","OPTION","operator_tokens.token_operator_dot","CONSUME2","SUBRULE3","operator_tokens.token_operator_round","AT_LEAST_ONE","whole_number","whole_number_zero","whole_number_one","whole_number_two","whole_number_three","whole_number_four","whole_number_five","whole_number_six","whole_number_seven","whole_number_eight","whole_number_nine","number_tokens.token_number_zero","number_tokens.token_number_one","number_tokens.token_number_two","number_tokens.token_number_three","number_tokens.token_number_four","number_tokens.token_number_five","number_tokens.token_number_six","number_tokens.token_number_seven","number_tokens.token_number_eight","number_tokens.token_number_nine","performSelfAnalysis","getParser","BaseSQLVisitor","getBaseCstVisitorConstructorWithDefaults","zip_outputs","arrays","operator","array_one","shift","array_two","zipped_output","Array","from","Math","max","length","_","i","array_one_value","array_two_value","unary_expression","ctx","operator_wrap_fn","operator_function","visit_function","options","visit","value","do_add_values","outputs","map","output","formatter","format_result","reduce","accumulator","do_divide_values","do_exponential_values","do_minus_values","do_modulus_values","do_multiply_values","binary_expression","left_hand_visit","left_hand","right_hand","right_hand_visits","right_hand_outputs","right_hand_visit","right_hand_values","Interpreter","validateVisitor","abs","bind","ceil","previous_values","die_size","num_dice","sign","next_values","push","floor","prng","format_dice_result","join","input","num_digits","decimal_value","round","key","keys","variables","get","string","image","random","Formatter","Dice","interpreter","parser","roll","lex_result","tokenize","errors","offset","Error","charAt","variable_map","Map","forEach","key_value","set","toLowerCase","cst"],"mappings":"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"}